<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨å®¶èº«é«”ç´€éŒ„ 2026</title>
    
    <!-- åŸºç¤å‡½å¼åº« -->
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- åœ–è¡¨èˆ‡åœ–ç¤º -->
    <script src="https://cdn.jsdelivr.net/npm/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.10.3/umd/Recharts.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- å·¥å…·åº« -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- è¼‰å…¥åœ“æ½¤å­—é«”ï¼šNoto Sans TC èˆ‡ M PLUS Rounded 1c -->
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400&family=Noto+Sans+TC:wght@400&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-earth: #f5f2e9;
            --accent-brown: #a98467;
            --border-cream: #faedcd;
        }

        /* çµ•å°å¼·åˆ¶ï¼šå…¨åŸŸå­—é«”ä¸€è‡´ã€çµ•ç„¡ç²—é«”ã€æ–‡å­—å…¨é¢æ”¾å¤§ */
        * {
            font-family: 'M PLUS Rounded 1c', 'Noto Sans TC', sans-serif !important;
            font-weight: 400 !important;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
        }

        body {
            background-color: var(--bg-earth);
            color: #6b705c;
            margin: 0;
            padding: 0;
            font-size: 22px; 
        }

        /* ç§»é™¤é è¨­ç²—é«”è¨­å®š */
        h1, h2, h3, h4, b, strong, button, span, div, p, input, textarea {
            font-weight: 400 !important;
        }

        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-earth); }
        ::-webkit-scrollbar-thumb { background: var(--border-cream); border-radius: 10px; }
        
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        .animate-bounce-slow { animation: bounce-slow 4s infinite ease-in-out; }
        
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow { animation: spin-slow 30s linear infinite; }

        .recharts-cartesian-axis-tick-value {
            font-size: 16px !important;
            fill: #a98467;
        }

        .recharts-tooltip-label, .recharts-tooltip-item-name, .recharts-tooltip-item-value {
            font-size: 18px !important;
        }
        
        .med-card {
            word-wrap: break-word;
            overflow-wrap: break-word;
            line-height: 1.8;
        }

        .modal-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDK æ¨¡çµ„è¼‰å…¥ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, onSnapshot, addDoc, deleteDoc, query } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        // æ›è¼‰è‡³ window ä¾› React ä½¿ç”¨
        window.FirebaseSDK = { initializeApp, getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, getFirestore, collection, doc, setDoc, onSnapshot, addDoc, deleteDoc, query };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, Fragment, useRef } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ReferenceLine } = window.Recharts;

        // åœ–ç¤ºå°è£
        const Icon = ({ name, size = 40, className = "" }) => {
            const containerRef = useRef(null);
            useEffect(() => {
                if (window.lucide && containerRef.current) {
                    containerRef.current.innerHTML = '';
                    const i = document.createElement('i');
                    const kebabName = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
                    i.setAttribute('data-lucide', kebabName);
                    containerRef.current.appendChild(i);
                    window.lucide.createIcons({
                        elements: [i],
                        attrs: { width: size, height: size, class: className }
                    });
                }
            }, [name, size, className]);
            return <span ref={containerRef} className="inline-flex items-center justify-center"></span>;
        };

        /**
         * Firebase é‡‘é‘°é…ç½® (å·²å¡«å…¥æ‚¨çš„å¥åº·ç´€éŒ„å°ˆæ¡ˆ)
         */
        const firebaseConfig = {
            apiKey: "AIzaSyCMo1zj-zXLtwGd1WFtISt_O6ku8pmZOMc",
            authDomain: "health-86609.firebaseapp.com",
            projectId: "health-86609",
            storageBucket: "health-86609.firebasestorage.app",
            messagingSenderId: "969606507760",
            appId: "1:969606507760:web:2223db1994907d1c97a635",
            measurementId: "G-Q1VYJQVRBF"
        };

        const MEMBERS = [
            { id: 'dad', name: 'çˆ¸çˆ¸', color: '#bae6fd', bgColor: 'bg-blue-100/70', border: 'border-blue-200', text: 'text-blue-500' },
            { id: 'mom', name: 'åª½åª½', color: '#fbcfe8', bgColor: 'bg-pink-100/70', border: 'border-pink-200', text: 'text-pink-500' },
            { id: 'me', name: 'æˆ‘', color: '#bbf7d0', bgColor: 'bg-green-100/70', border: 'border-green-200', text: 'text-green-500' },
        ];
        const MONTH_NAMES = ['ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'];
        const WEEKDAYS = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];

        function App() {
            const [user, setUser] = useState(null);
            const [db, setDb] = useState(null);
            const [auth, setAuth] = useState(null);
            const [records, setRecords] = useState([]);
            const [currentDate, setCurrentDate] = useState(new Date(2026, 0, 1));
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [selectedDate, setSelectedDate] = useState(null);
            const [editingRecord, setEditingRecord] = useState(null);
            const [loading, setLoading] = useState(true);
            const [authError, setAuthError] = useState(null);

            const appId = 'health-diary-private-v1';

            // 1. åˆå§‹åŒ– Firebase
            useEffect(() => {
                const init = setInterval(() => {
                    if (window.FirebaseSDK) {
                        clearInterval(init);
                        const app = window.FirebaseSDK.initializeApp(firebaseConfig);
                        const firestore = window.FirebaseSDK.getFirestore(app);
                        const fireauth = window.FirebaseSDK.getAuth(app);
                        setDb(firestore);
                        setAuth(fireauth);

                        window.FirebaseSDK.onAuthStateChanged(fireauth, (u) => {
                            setUser(u);
                            setLoading(false);
                        });
                    }
                }, 100);
                return () => clearInterval(init);
            }, []);

            // 2. å¸³è™Ÿç§æœ‰è³‡æ–™åŒæ­¥
            useEffect(() => {
                if (!user || !db) return;
                const q = window.FirebaseSDK.collection(db, 'artifacts', appId, 'users', user.uid, 'health_records');
                const unsubscribe = window.FirebaseSDK.onSnapshot(q, (snapshot) => {
                    setRecords(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
                return () => unsubscribe();
            }, [user, db]);

            const login = async () => {
                setAuthError(null);
                const provider = new window.FirebaseSDK.GoogleAuthProvider();
                try {
                    await window.FirebaseSDK.signInWithPopup(auth, provider);
                } catch (err) {
                    if (err.code === 'auth/unauthorized-domain') {
                        setAuthError(`ç¶²åŸŸæˆæ¬ŠéŒ¯èª¤ã€‚è«‹åœ¨ Firebase å¾Œå°åŠ å…¥ã€Œ${window.location.hostname}ã€ã€‚`);
                    } else { setAuthError(err.message); }
                }
            };

            const [formData, setFormData] = useState({ memberId: 'dad', hospital: '', department: '', problem: '', systolic: '', diastolic: '', heartRate: '', weight: '', medication: '', frequency: '', medDuration: '' });

            const handleSubmit = async (e) => {
                e.preventDefault();
                const path = window.FirebaseSDK.collection(db, 'artifacts', appId, 'users', user.uid, 'health_records');
                const data = { ...formData, date: selectedDate, updatedAt: new Date().toISOString() };
                if (editingRecord) await window.FirebaseSDK.setDoc(window.FirebaseSDK.doc(db, 'artifacts', appId, 'users', user.uid, 'health_records', editingRecord.id), data);
                else await window.FirebaseSDK.addDoc(path, data);
                setIsModalOpen(false);
            };

            const month = currentDate.getMonth();
            const year = currentDate.getFullYear();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const startingDay = new Date(year, month, 1).getDay();

            const chartData = useMemo(() => {
                return Array.from({ length: daysInMonth }, (_, i) => {
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i + 1).padStart(2, '0')}`;
                    const dayObj = { displayDate: `${month + 1}/${i + 1}` };
                    records.filter(r => r.date === dateStr).forEach(r => {
                        const mid = r.memberId;
                        if (r.systolic) dayObj[`${mid}_systolic`] = parseFloat(r.systolic);
                        if (r.diastolic) dayObj[`${mid}_diastolic`] = parseFloat(r.diastolic);
                        if (r.heartRate) dayObj[`${mid}_heartRate`] = parseFloat(r.heartRate);
                        if (r.weight) dayObj[`${mid}_weight`] = parseFloat(r.weight);
                    });
                    return dayObj;
                });
            }, [records, month, year, daysInMonth]);

            const exportToCSV = () => {
                if (records.length === 0) return;
                const headers = ["æ—¥æœŸ", "æˆå“¡", "é†«é™¢", "ç§‘åˆ¥", "ç´€éŒ„", "é«˜å£“", "ä½å£“", "å¿ƒè·³", "é«”é‡", "è—¥å", "é »ç‡"];
                const csvRows = [headers, ...records.map(r => [r.date, MEMBERS.find(m => m.id === r.memberId)?.name || "", r.hospital||"", r.department||"", (r.problem||"").replace(/\n/g," "), r.systolic||"", r.diastolic||"", r.heartRate||"", r.weight||"", r.medication||"", r.frequency||""])];
                const csvString = csvRows.map(row => row.map(v => `"${v}"`).join(",")).join("\n");
                const blob = new Blob(["\ufeff" + csvString], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = `å¥åº·å ±è¡¨.csv`;
                link.click();
            };

            if (loading) return null;

            if (!user) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-8 bg-[#f5f2e9]">
                        <div className="bg-white rounded-[4rem] border-4 border-dashed border-[#faedcd] p-12 text-center max-w-2xl w-full shadow-2xl">
                            <Icon name="Heart" size={80} className="text-pink-300 mx-auto mb-6 animate-bounce-slow" />
                            <h1 className="text-4xl text-[#a98467] mb-4">å…¨å®¶èº«é«”ç´€éŒ„ 2026</h1>
                            <p className="text-slate-400 mb-10 text-xl font-normal leading-relaxed">è«‹ç™»å…¥ Google å¸³è™Ÿ<br/>é–‹å•Ÿæ‚¨çš„ç§æœ‰å¥åº·åŒæ­¥ç©ºé–“ ğŸŒ³</p>
                            {authError && <div className="bg-red-50 p-6 rounded-3xl mb-8 text-left text-red-600 text-sm font-normal"><p>âš ï¸ {authError}</p></div>}
                            <button onClick={login} className="w-full py-6 bg-white border-4 border-[#faedcd] text-[#a98467] rounded-full text-2xl hover:bg-[#fefae0] transition-all flex items-center justify-center gap-4 shadow-xl active:scale-95">
                                <Icon name="LogIn" size={32} /> é€é Google å¸³è™Ÿç™»å…¥
                            </button>
                            <p className="mt-8 text-slate-300 text-base font-normal">å¸³è™Ÿä¹‹é–“è³‡æ–™ä¸äº’é€šï¼Œç¢ºä¿éš±ç§ ğŸ”’</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pb-20">
                    <header className="sticky top-0 z-30 px-8 py-6 bg-white/70 backdrop-blur-md border-b-2 border-dashed border-[#e9edc9] flex items-center justify-between">
                        <div className="flex items-center gap-4"><Icon name="Sun" className="text-[#d4a373] animate-spin-slow" size={32} /><span className="text-xl text-[#a98467] italic hidden lg:block font-normal">Family Health 2026</span></div>
                        <div className="flex items-center gap-6 bg-[#fefae0] rounded-full px-10 py-3 border border-[#faedcd] shadow-sm">
                            <button onClick={() => setCurrentDate(new Date(year, month - 1, 1))} className="text-[#d4a373] hover:scale-125 transition-all"><Icon name="ChevronLeft" size={36} /></button>
                            <span className="text-3xl min-w-[200px] text-center underline decoration-[#faedcd] decoration-4 font-normal">{year} / {MONTH_NAMES[month]}</span>
                            <button onClick={() => setCurrentDate(new Date(year, month + 1, 1))} className="text-[#d4a373] hover:scale-125 transition-all"><Icon name="ChevronRight" size={36} /></button>
                        </div>
                        <div className="flex items-center gap-4">
                            <button onClick={exportToCSV} className="p-4 bg-white border-2 border-dashed border-[#faedcd] text-[#a98467] rounded-3xl hover:bg-[#fefae0] flex items-center gap-3 text-lg shadow-sm font-normal"><Icon name="FileDown" size={28} /> <span className="hidden sm:inline">åŒ¯å‡º</span></button>
                            <button onClick={() => window.FirebaseSDK.signOut(auth)} className="p-4 text-[#a98467] hover:scale-110"><Icon name="LogOut" size={32} /></button>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-8 space-y-12">
                        {/* è—¥ç®±ç´€éŒ„ */}
                        <section className="bg-white rounded-[4rem] p-10 shadow-sm border-2 border-dashed border-[#faedcd] relative">
                            <div className="absolute -top-7 left-14 bg-[#f5f2e9] px-8 py-2 flex items-center gap-4 z-10 text-[#a98467] font-normal"><Icon name="Pill" size={40} /><h2 className="text-3xl">æ—¥å¸¸è—¥ç®±æ¸…å–® ğŸ’Š</h2></div>
                            <div className="grid grid-cols-1 sm:grid-cols-3 gap-10 pt-10">
                                {MEMBERS.map(m => (
                                    <div key={m.id} className={`${m.bgColor} rounded-[3.5rem] p-10 border-2 border-white shadow-sm relative med-card`}>
                                        <div className="flex items-center gap-5 mb-8 text-3xl font-normal"><div className={`w-8 h-8 rounded-full ${m.text.replace('text', 'bg')} border-2 border-white`}></div><span className={m.text}>{m.name}</span></div>
                                        <div className="space-y-6">
                                            {records.filter(r => r.memberId === m.id && r.medication).length > 0 ? (
                                                records.filter(r => r.memberId === m.id && r.medication).slice(0, 3).map((med, idx) => (
                                                    <div key={idx} className="bg-white/95 p-6 rounded-[2.5rem] border border-[#faedcd] shadow-sm space-y-2">
                                                        <div className="text-slate-700 border-b border-[#faedcd] pb-2 text-2xl font-normal">{med.medication}</div>
                                                        <div className="text-slate-500 text-xl font-normal">é »ç‡ï¼š{med.frequency || 'æœªå¡«'}</div>
                                                    </div>
                                                ))
                                            ) : <p className="text-xl text-[#a98467] opacity-60 italic py-10 text-center font-normal">ç›®å‰æ²’è—¥è—¥ç´€éŒ„ ğŸƒ</p>}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </section>

                        {/* æ—¥æ›†å€ */}
                        <section className="bg-white rounded-[5rem] shadow-xl border-4 border-white outline outline-1 outline-[#faedcd] overflow-hidden">
                            <div className="grid grid-cols-7 bg-[#fefae0]/40 border-b-2 border-dashed border-[#faedcd] font-normal text-[#d4a373] tracking-[0.3em]">{WEEKDAYS.map(day => <div key={day} className="py-7 text-center text-xl">{day}</div>)}</div>
                            <div className="grid grid-cols-7">
                                {[...Array(startingDay)].map((_, i) => <div key={`e-${i}`} className="min-h-[160px] bg-[#f5f2e9]/20 border-b border-r border-[#faedcd]/20" />)}
                                {[...Array(daysInMonth)].map((_, i) => {
                                    const d = i + 1;
                                    const dStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                                    const dayRecs = records.filter(r => r.date === dStr);
                                    const isToday = new Date().toDateString() === new Date(year, month, d).toDateString();
                                    return (
                                        <div key={d} onClick={() => { setSelectedDate(dStr); setEditingRecord(null); setFormData({ memberId: 'dad', hospital: '', department: '', problem: '', systolic: '', diastolic: '', heartRate: '', weight: '', medication: '', frequency: '', medDuration: '' }); setIsModalOpen(true); }} className="min-h-[160px] border-b border-r border-[#faedcd]/20 p-5 hover:bg-[#e9edc9]/20 transition-all cursor-pointer group">
                                            <div className={`text-lg w-14 h-14 flex items-center justify-center rounded-3xl mb-5 font-normal ${isToday ? 'bg-[#d4a373] text-white shadow-lg' : 'text-[#ccd5ae]'}`}>{d}</div>
                                            <div className="flex flex-col gap-3 font-normal">{dayRecs.map(rec => { const m = MEMBERS.find(mem => mem.id === rec.memberId); return <div key={rec.id} onClick={(e) => { e.stopPropagation(); setSelectedDate(rec.date); setEditingRecord(rec); setFormData(rec); setIsModalOpen(true); }} className={`w-full text-base p-3 rounded-3xl border-b-2 ${m.bgColor} ${m.text} border-white shadow-sm truncate`}>{rec.department || rec.hospital || 'â—'}</div>; })}</div>
                                        </div>
                                    );
                                })}
                            </div>
                        </section>

                        {/* å…©æ’åœ–è¡¨ä½ˆå±€ */}
                        <section className="space-y-12 pt-10">
                            <div className="flex items-center gap-6 px-10 text-[#a98467] font-normal"><Icon name="Activity" size={40} /><h2 className="text-3xl italic">å¥åº·è¶¨å‹¢åˆ†æ</h2><div className="flex-1 border-b-4 border-dotted border-[#faedcd]"></div></div>
                            <div className="flex flex-col gap-12">
                                {/* ç¬¬ä¸€æ’ï¼šè¡€å£“ */}
                                <div className="bg-white p-12 rounded-[5rem] shadow-sm border border-[#faedcd]/50 h-[480px]">
                                    <div className="flex items-center gap-4 mb-6 text-[#a98467] font-normal text-2xl"><Icon name="HeartPulse" size={32} /> è¡€å£“ç´€éŒ„ (å¯¦ç·š:æ”¶ç¸® / è™›ç·š:èˆ’å¼µ)</div>
                                    <ResponsiveContainer width="100%" height="90%">
                                        <LineChart data={chartData} margin={{ top: 20, right: 40, left: 10, bottom: 10 }}>
                                            <CartesianGrid strokeDasharray="5 5" vertical={false} stroke="#faedcd" />
                                            <XAxis dataKey="displayDate" dy={20} style={{fontSize: '16px'}} axisLine={false} tickLine={false} />
                                            <YAxis width={70} domain={['dataMin - 10', 'dataMax + 10']} style={{fontSize: '16px'}} />
                                            <Tooltip contentStyle={{ borderRadius: '30px', border: '3px dashed #faedcd', backgroundColor: '#fefae0', fontSize: '18px' }} />
                                            {MEMBERS.map(m => (<Fragment key={m.id}><Line type="monotone" dataKey={`${m.id}_systolic`} stroke={m.color} strokeWidth={7} dot={{ r: 8, fill: '#fff', strokeWidth: 3 }} connectNulls strokeLinecap="round" /><Line type="monotone" dataKey={`${m.id}_diastolic`} stroke={m.color} strokeWidth={3} strokeDasharray="8 8" dot={{ r: 7 }} connectNulls strokeLinecap="round" /></Fragment>))}
                                            <ReferenceLine y={140} stroke="#d4a373" strokeDasharray="8 8" />
                                        </LineChart>
                                    </ResponsiveContainer>
                                </div>
                                {/* ç¬¬äºŒæ’ï¼šå¿ƒè·³ã€é«”é‡ä¸¦æ’ */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-12">
                                    <div className="bg-white p-12 rounded-[4rem] shadow-sm border border-[#faedcd]/50 h-[380px]">
                                        <div className="flex items-center gap-4 mb-6 text-[#a98467] font-normal text-2xl"><Icon name="Activity" size={32} /> å¿ƒè·³æ³¢å‹• (bpm)</div>
                                        <ResponsiveContainer width="100%" height="80%">
                                            <LineChart data={chartData} margin={{ top: 15, right: 30, left: 10, bottom: 10 }}>
                                                <CartesianGrid strokeDasharray="5 5" vertical={false} stroke="#faedcd" />
                                                <XAxis dataKey="displayDate" style={{fontSize: '16px'}} /><YAxis width={70} domain={[40, 120]} style={{fontSize: '16px'}} />
                                                {MEMBERS.map(m => (<Line key={m.id} type="monotone" dataKey={`${m.id}_heartRate`} stroke={m.color} strokeWidth={7} dot={{ r: 8 }} connectNulls strokeLinecap="round" />))}
                                            </LineChart>
                                        </ResponsiveContainer>
                                    </div>
                                    <div className="bg-white p-12 rounded-[4rem] shadow-sm border border-[#faedcd]/50 h-[380px]">
                                        <div className="flex items-center gap-4 mb-6 text-[#a98467] font-normal text-2xl"><Icon name="Scale" size={32} /> é«”é‡è®Šå‹• (kg)</div>
                                        <ResponsiveContainer width="100%" height="80%">
                                            <LineChart data={chartData} margin={{ top: 15, right: 30, left: 10, bottom: 10 }}>
                                                <CartesianGrid strokeDasharray="5 5" vertical={false} stroke="#faedcd" />
                                                <XAxis dataKey="displayDate" style={{fontSize: '16px'}} /><YAxis width={70} domain={['auto', 'auto']} style={{fontSize: '16px'}} />
                                                {MEMBERS.map(m => (<Line key={m.id} type="monotone" dataKey={`${m.id}_weight`} stroke={m.color} strokeWidth={7} dot={{ r: 8 }} connectNulls strokeLinecap="round" />))}
                                            </LineChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </main>

                    {/* å½ˆå‡ºè¦–çª— */}
                    {isModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-8 bg-[#6b705c]/40 backdrop-blur-md">
                            <div className="bg-white rounded-[5rem] w-full max-w-4xl max-h-[95vh] overflow-y-auto shadow-2xl border-4 border-white outline outline-4 outline-[#faedcd] modal-fade-in">
                                <div className="p-12 sm:p-16">
                                    <div className="flex justify-between items-center mb-14 text-[#6b705c] font-normal">
                                        <div><h2 className="text-5xl text-[#a98467]">å½©è‰²å°ç­†è¨˜ ğŸŒ³</h2><p className="text-[#d4a373] text-2xl mt-4 italic underline decoration-dotted">{selectedDate}</p></div>
                                        <button onClick={() => setIsModalOpen(false)} className="p-6 bg-[#f5f2e9] text-[#ccd5ae] rounded-[2.5rem] hover:scale-110 active:rotate-90 transition-all outline-none font-normal"><Icon name="X" size={64} /></button>
                                    </div>
                                    <form onSubmit={handleSubmit} className="space-y-16">
                                        <div className="grid grid-cols-3 gap-8">
                                            {MEMBERS.map(m => (<button key={m.id} type="button" onClick={() => setFormData({...formData, memberId: m.id})} className={`py-8 rounded-[3rem] border-2 text-2xl transition-all ${formData.memberId === m.id ? `border-[#a98467] ${m.bgColor} ${m.text} shadow-2xl scale-105 font-normal` : `bg-[#f5f2e9] text-[#ccd5ae]`}`}>{m.name}</button>))}
                                        </div>
                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-16 text-[#6b705c] font-normal">
                                            <div className="space-y-10">
                                                <label className="block text-lg text-[#ccd5ae] italic">å°±è¨ºæè¿° (è—¥ã€èº«é«”ç‹€æ³)</label>
                                                <input type="text" value={formData.hospital} onChange={e => setFormData({...formData, hospital: e.target.value})} className="w-full px-10 py-8 bg-[#f5f2e9] rounded-[3rem] outline-none text-2xl font-normal" placeholder="é†«é™¢åç¨±" />
                                                <input type="text" value={formData.department} onChange={e => setFormData({...formData, department: e.target.value})} className="w-full px-10 py-8 bg-[#f5f2e9] rounded-[3rem] outline-none text-2xl font-normal" placeholder="ç§‘åˆ¥" />
                                                <textarea value={formData.problem} onChange={e => setFormData({...formData, problem: e.target.value})} className="w-full px-10 py-8 bg-[#f5f2e9] rounded-[3rem] outline-none h-[220px] text-2xl font-normal" placeholder="æè¿°æ„Ÿè¦ºã€è—¥å“ç‹€æ³..."></textarea>
                                            </div>
                                            <div className="space-y-12">
                                                <div className="bg-[#fefae0] p-12 rounded-[4rem] border-2 border-dashed border-[#faedcd] space-y-10 shadow-sm"><h3 className="text-lg text-[#d4a373] uppercase tracking-widest flex items-center gap-4 font-normal">ğŸ èº«é«”æ•¸æ“š</h3>
                                                    <div className="grid grid-cols-2 gap-8">
                                                        <div className="bg-white p-6 rounded-[2.5rem] shadow-sm"><label className="text-base text-[#ccd5ae] block mb-3 text-center">æ”¶ç¸®å£“</label><input type="number" value={formData.systolic} onChange={e => setFormData({...formData, systolic: e.target.value})} className="w-full text-[#a98467] outline-none text-4xl text-center" /></div>
                                                        <div className="bg-white p-6 rounded-[2.5rem] shadow-sm"><label className="text-base text-[#ccd5ae] block mb-3 text-center">èˆ’å¼µå£“</label><input type="number" value={formData.diastolic} onChange={e => setFormData({...formData, diastolic: e.target.value})} className="w-full text-[#a98467] outline-none text-4xl text-center" /></div>
                                                        <div className="bg-white p-6 rounded-[2.5rem] shadow-sm"><label className="text-base text-[#ccd5ae] block mb-3 text-center">å¿ƒè·³</label><input type="number" value={formData.heartRate} onChange={e => setFormData({...formData, heartRate: e.target.value})} className="w-full text-[#a98467] outline-none text-4xl text-center" /></div>
                                                        <div className="bg-white p-6 rounded-[2.5rem] shadow-sm"><label className="text-base text-[#ccd5ae] block mb-3 text-center">é«”é‡</label><input type="number" step="0.1" value={formData.weight} onChange={e => setFormData({...formData, weight: e.target.value})} className="w-full text-[#a98467] outline-none text-4xl text-center" /></div>
                                                    </div>
                                                </div>
                                                <div className="bg-[#e9edc9]/40 p-12 rounded-[4rem] border-2 border-dashed border-[#ccd5ae] space-y-10 shadow-sm"><h3 className="text-lg text-[#6b705c] uppercase tracking-widest flex items-center gap-4 font-normal">ğŸ¥¨ è—¥ç‰©ç´€éŒ„</h3>
                                                    <input type="text" value={formData.medication} onChange={e => setFormData({...formData, medication: e.target.value})} className="w-full px-10 py-8 bg-white rounded-[3rem] outline-none text-2xl shadow-sm" placeholder="è—¥å“åç¨±" />
                                                </div>
                                            </div>
                                        </div>
                                        <div className="flex gap-10 pt-10 font-normal">
                                            {editingRecord && <button type="button" onClick={() => { if(confirm('åˆªé™¤å¾Œç„¡æ³•æ¢å¾©ï¼Œç¢ºå®šå—ï¼Ÿ')) window.FirebaseSDK.deleteDoc(window.FirebaseSDK.doc(db, 'artifacts', appId, 'users', user.uid, 'health_records', editingRecord.id)); setIsModalOpen(false); }} className="p-10 bg-[#f5f2e9] text-[#ccd5ae] rounded-[3.5rem] hover:bg-red-50 hover:text-red-400 transition-all shadow-sm active:scale-95 font-normal"><Icon name="Trash2" size={56} /></button>}
                                            <button type="submit" className="flex-1 py-10 bg-[#d4a373] text-white text-4xl rounded-[3.5rem] shadow-xl hover:bg-[#a98467] active:scale-95 transition-all text-nowrap outline-none text-center font-normal">è“‹ç« å„²å­˜ç´€éŒ„ ğŸ‚</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>